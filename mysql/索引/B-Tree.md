
# B—Tree 索引

B-Tree 常用来实现 **数据库** 和 **文件系统** 的一个数据结构, 它能保持数据的有序性, 很适合用来查找范围类型的数据

##### B-Tree 的工作原理

例如有一颗 **m 阶 B-Tree** 从根结点开始插入数据, 每一节点当中保存 **键值** **指针** **数据** 三种类型的数据, **键值** 就是数据库当中的索引数据, **指针** 指向的该节点的孩子, **数据** 则是指向数据存放地址的一个句柄, 每一个节点最多只能有 m 个孩子, 并且在插入的时候对比当前的键值的大小决定是否在当前的节点插入或者插入该节点的那个孩子, 如果是查询, 就会从根结点开始, 同样是对比范围, 然后确定查找的范围, 最后要么查找到该数据, 要么就是空值

##### B-Tree 的特性

1. 每个节点最多有m个孩子。
2. 除了根节点和叶子节点外，其它每个节点至少有Ceil(m/2)个孩子。
3. 若根节点不是叶子节点，则至少有2个孩子
4. 所有叶子节点都在同一层，且不包含其它关键字信息
5. 每个非终端节点包含n个关键字信息（P0,P1,…Pn, k1,…kn）
6. 关键字的个数n满足：ceil(m/2)-1 <= n <= m-1
7. ki(i=1,…n)为关键字，且关键字升序排序。
8. Pi(i=1,…n)为指向子树根节点的指针。P(i-1)指向的子树的所有节点关键字均小于ki，但都大于k(i-1)

##### 适合何种类型的查找

B—Tree 索引适用于全键值、键值范围、最左前缀查找

- 全值匹配 和索引中的所有的列进行匹配
- 匹配最左前缀 匹配索引当中的第一列数据
- 匹配列前缀 只匹配某一列的值的开头部分, 例如 J 开头的姓的人
- 匹配范围值 查找某个范围内的值
- 精确匹配某一列并范围匹配另外一列 例如查找所有姓为 Allen, 并且名字为字母 K 开头的人
- 只访问索引的查询 查询的过程值需要防伪索引, 而无需访问数据行

##### 一些限制

- 如果不是从最左边的列开始查找, 则无法使用索引
- 不能跳过索引中列, 也就是匹配的过程要按照索引定义的列的顺序来匹配
- 在一个索引集合当中, 其中一个查询有某个列的范围查询, 则这个列右边的所有的列都无法使用索引优化技术
